var Y=Object.defineProperty;var q=(m,t,e)=>t in m?Y(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var f=(m,t,e)=>q(m,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const T=1200,P=700,R=0,E=800,b=0,A=800,K=60,Z=1.35,D=4,I=10,J=3.5,Q=25,j=10,z=-30,tt=500,et=200,it=800,st=2,ot=.5,nt=100,lt=5e3,ct=2e3,ht=-1e4,rt=-25e3,U=160,B=1.2,W=10,M=[80,200,255],F=[255,180,110],y=[220,170,50],C=[120,110,95],S=[85,80,75],O=[230,235,245],at=[255,200,80];function dt(m,t,e){return Math.max(t,Math.min(e,m))}function p(m,t,e,n,i){if(i){const s=Math.floor(T/2+m*(B*W/4)),l=Math.floor((t-n)*B+200);return[s,l]}else{const s=Math.floor((m-e)*B+200),l=Math.floor(P/2-t*(B*W/4));return[s,l]}}function x(m){return`rgb(${m[0]}, ${m[1]}, ${m[2]})`}function k(m,t){return`rgba(${m[0]}, ${m[1]}, ${m[2]}, ${t})`}class xt{constructor(t){f(this,"seed");this.seed=t}next(){let t=this.seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}uniform(t,e){return this.next()*(e-t)+t}randint(t,e){return Math.floor(this.next()*(e-t+1))+t}}class _{constructor(t){f(this,"seed");f(this,"a1");f(this,"a2");f(this,"w1");f(this,"w2");f(this,"phase1");f(this,"phase2");f(this,"slope");this.seed=t.seed,this.a1=t.a1,this.a2=t.a2,this.w1=t.w1,this.w2=t.w2,this.phase1=t.phase1,this.phase2=t.phase2,this.slope=t.slope}y(t){return this.slope*(t-R)/200+this.a1*Math.sin(this.w1*t+this.phase1)+this.a2*Math.sin(this.w2*t+this.phase2)}x(t){return this.slope*(t-b)/200+this.a1*Math.sin(this.w1*t+this.phase1)+this.a2*Math.sin(this.w2*t+this.phase2)}static random(){const t=Math.floor(Math.random()*1e6),e=new xt(t);return new _({seed:t,a1:e.uniform(8,18),a2:e.uniform(3,10),w1:e.uniform(.01,.018),w2:e.uniform(.02,.035),phase1:e.uniform(0,Math.PI*2),phase2:e.uniform(0,Math.PI*2),slope:e.uniform(-8,8)})}}class N{constructor(t){f(this,"plan");f(this,"x");f(this,"y");f(this,"heading");f(this,"headingTarget");f(this,"score");f(this,"outsideTime");f(this,"finished");f(this,"failed");f(this,"verticalMode");f(this,"actualPoints");f(this,"economics");this.plan=t.plan,this.x=t.x,this.y=t.y,this.heading=t.heading,this.headingTarget=t.headingTarget,this.score=t.score,this.outsideTime=t.outsideTime,this.finished=t.finished,this.failed=t.failed,this.verticalMode=t.verticalMode,this.actualPoints=t.actualPoints,this.economics=t.economics}static createEmptyEconomics(){return{grossRevenue:0,remediationCosts:0,scheduleVariance:0,downstreamPenalty:0,timeInTight:0,timeInOK:0,timeOutside:0,totalTime:0,completionBonus:0}}getAccuracyPercent(){return this.economics.totalTime===0?100:(this.economics.timeInTight+this.economics.timeInOK)/this.economics.totalTime*100}getNetProfit(){return this.economics.grossRevenue-this.economics.remediationCosts-this.economics.downstreamPenalty+this.economics.completionBonus}static new(t=!1){const e=_.random();let n,i,s;return t?(i=b,n=e.x(i),s=0):(n=R,i=e.y(n),s=0),new N({plan:e,x:n,y:i,heading:s,headingTarget:s,score:0,outsideTime:0,finished:!1,failed:!1,verticalMode:t,actualPoints:[[n,i]],economics:N.createEmptyEconomics()})}}class ft{constructor(t){f(this,"canvas");f(this,"ctx");f(this,"drillRigImage",null);f(this,"drillRigLoaded",!1);this.canvas=t,this.canvas.width=T,this.canvas.height=P;const e=t.getContext("2d");if(!e)throw new Error("Could not get 2D context");this.ctx=e,this.drillRigImage=new Image,this.drillRigImage.onload=()=>{this.drillRigLoaded=!0},this.drillRigImage.src="/drill-rig.png"}clear(){const t=this.ctx.createLinearGradient(0,0,0,P);t.addColorStop(0,"#2a2520"),t.addColorStop(.5,"#1a1612"),t.addColorStop(1,"#252018"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,T,P),this.addRockTexture()}addRockTexture(){const t=this.ctx.getImageData(0,0,T,P),e=t.data;for(let n=0;n<e.length;n+=4){const i=(Math.random()-.5)*15;e[n]+=i,e[n+1]+=i,e[n+2]+=i}this.ctx.putImageData(t,0,0)}drawGrid(){this.ctx.strokeStyle="rgba(80, 70, 60, 0.15)",this.ctx.lineWidth=1;for(let t=0;t<P;t+=120)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(T,t),this.ctx.stroke();this.ctx.strokeStyle="rgba(70, 60, 50, 0.08)";for(let t=0;t<T;t+=200)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,P),this.ctx.stroke()}drawCorridor(t,e,n,i,s,l,u){const d=[];if(t.verticalMode){const c=[],o=[],r=[],a=[];for(let g=l;g<=u;g+=4){const w=t.plan.x(g);d.push(p(w,g,e,n,!0)),c.push(p(w-I,g,e,n,!0)),o.push(p(w+I,g,e,n,!0)),r.push(p(w-D,g,e,n,!0)),a.push(p(w+D,g,e,n,!0))}if(c.length>=2&&this.drawPolygon([...c,...o.reverse()],C,.25),r.length>=2){const g=[...r,...a.reverse()];this.drawPolygon(g,y,.35),this.drawOreVeins(g,!0)}}else{const c=[],o=[],r=[],a=[];for(let g=i;g<=s;g+=4){const w=t.plan.y(g);d.push(p(g,w,e,n,!1)),c.push(p(g,w+I,e,n,!1)),o.push(p(g,w-I,e,n,!1)),r.push(p(g,w+D,e,n,!1)),a.push(p(g,w-D,e,n,!1))}if(c.length>=2&&this.drawPolygon([...c,...o.reverse()],C,.25),r.length>=2){const g=[...r,...a.reverse()];this.drawPolygon(g,y,.35),this.drawOreVeins(g,!1)}}return{planLine:d}}drawPolygon(t,e,n){if(!(t.length<3)){this.ctx.fillStyle=k(e,n),this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(let i=1;i<t.length;i++)this.ctx.lineTo(t[i][0],t[i][1]);this.ctx.closePath(),this.ctx.fill()}}drawOreVeins(t,e){const n=Math.floor(t.length/20);for(let i=0;i<n;i++){const s=Math.floor(i/n*t.length/2),l=t[s];l&&(this.ctx.fillStyle=k(at,.4),this.ctx.beginPath(),this.ctx.arc(l[0],l[1],2,0,Math.PI*2),this.ctx.fill())}}drawPlanLine(t){if(!(t.length<2)){this.ctx.strokeStyle=k(M,.8),this.ctx.lineWidth=2,this.ctx.shadowBlur=8,this.ctx.shadowColor=x(M),this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);this.ctx.stroke(),this.ctx.shadowBlur=0}}drawPlannedDrillholeLabels(t,e,n,i,s,l,u){const h=t.verticalMode,c=this.drillRigImage?this.drillRigImage.width*.12:0;if(h){if(b>=i-20&&b<=s+20){const o=t.plan.x(b),[r,a]=p(o,b,e,n,!0),g=c+20;this.drawPlanLabel("Planned Collar",r,a,"top",g)}if(A>=i-20&&A<=s+20){const o=t.plan.x(A),[r,a]=p(o,A,e,n,!0);this.drawPlanLabel("Planned Toe",r,a,"bottom",0)}}else{if(R>=l-20&&R<=u+20){const o=t.plan.y(R),[r,a]=p(R,o,e,n,!1),g=c+30;this.drawPlanLabel("Planned Collar",r,a,"left",g)}if(E>=l-20&&E<=u+20){const o=t.plan.y(E),[r,a]=p(E,o,e,n,!1);this.drawPlanLabel("Planned Toe",r,a,"right",0)}}}drawPlanLabel(t,e,n,i,s=0){this.ctx.font='bold 13px Consolas, "Courier New", monospace',this.ctx.textAlign="center",this.ctx.textBaseline="middle";const u=this.ctx.measureText(t).width,h=13,d=6;let c=0,o=0;switch(i){case"top":o=-(30+s);break;case"bottom":o=30+s;break;case"left":c=-(70+s);break;case"right":c=70+s;break}const r=e+c,a=n+o;this.ctx.fillStyle="rgba(0, 20, 30, 0.85)",this.ctx.fillRect(r-u/2-d,a-h/2-d,u+d*2,h+d*2),this.ctx.strokeStyle=x(M),this.ctx.lineWidth=1.5,this.ctx.shadowBlur=4,this.ctx.shadowColor=x(M),this.ctx.strokeRect(r-u/2-d,a-h/2-d,u+d*2,h+d*2),this.ctx.shadowBlur=0,this.ctx.strokeStyle=k(M,.6),this.ctx.lineWidth=1.5,this.ctx.setLineDash([3,3]),this.ctx.beginPath(),this.ctx.moveTo(e,n),this.ctx.lineTo(r,a),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle=x(M),this.ctx.shadowBlur=3,this.ctx.shadowColor=x(M),this.ctx.fillText(t,r,a),this.ctx.shadowBlur=0,this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic"}drawActualPath(t,e,n,i,s,l,u){const h=[],d=t.actualPoints.slice(-4e3);for(const[c,o]of d)t.verticalMode?o>=l-20&&o<=u+20&&h.push(p(c,o,e,n,!0)):c>=i-20&&c<=s+20&&h.push(p(c,o,e,n,!1));if(h.length>=2){this.ctx.strokeStyle="rgba(60, 50, 40, 0.6)",this.ctx.lineWidth=8,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(h[0][0],h[0][1]);for(let c=1;c<h.length;c++)this.ctx.lineTo(h[c][0],h[c][1]);this.ctx.stroke(),this.ctx.strokeStyle=k(F,.9),this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.moveTo(h[0][0],h[0][1]);for(let c=1;c<h.length;c++)this.ctx.lineTo(h[c][0],h[c][1]);this.ctx.stroke()}}drawDrillRig(t,e,n){if(!this.drillRigLoaded||!this.drillRigImage)return;let i,s;if(t.verticalMode){const d=t.plan.x(b);[i,s]=p(d,b,e,n,!0)}else{const d=t.plan.y(R);[i,s]=p(R,d,e,n,!1)}const l=.12,u=this.drillRigImage.width*l,h=this.drillRigImage.height*l;t.verticalMode?(this.ctx.save(),this.ctx.translate(i,s-h/2),this.ctx.rotate(Math.PI/2),this.ctx.drawImage(this.drillRigImage,-u/2,-h/2,u,h),this.ctx.restore()):this.ctx.drawImage(this.drillRigImage,i-u-10,s-h/2,u,h)}drawDrillHead(t,e,n){const i=p(t.x,t.y,e,n,t.verticalMode);this.ctx.fillStyle=x(F),this.ctx.beginPath(),this.ctx.arc(i[0],i[1],7,0,Math.PI*2),this.ctx.fill();let s,l;t.verticalMode?(s=i[0]+Math.floor(24*Math.sin(t.heading)),l=i[1]+Math.floor(24*Math.cos(t.heading))):(s=i[0]+Math.floor(24*Math.cos(t.heading)),l=i[1]-Math.floor(24*Math.sin(t.heading))),this.ctx.strokeStyle=x(F),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(i[0],i[1]),this.ctx.lineTo(s,l),this.ctx.stroke()}formatMoney(t){return(t>=0?"$":"-$")+Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}drawHUD(t,e){let n,i,s;t.verticalMode?(n="VERTICAL",i=`Depth Y: ${t.y.toFixed(1).padStart(7)} m / ${A.toFixed(0)} m`,s="← → steer | T toggle | R restart"):(n="HORIZONTAL",i=`Depth X: ${t.x.toFixed(1).padStart(7)} m / ${E.toFixed(0)} m`,s="↑ ↓ steer | T toggle | R restart");const l=t.economics,u=t.getNetProfit(),h=t.getAccuracyPercent();this.drawDrillWatermark();const d=[i,`Deviation: ${e.toFixed(2).padStart(6)} m`,`Heading: ${(t.heading*180/Math.PI).toFixed(1).padStart(6)}°`,`Outside: ${t.outsideTime.toFixed(1)} / ${J.toFixed(1)} s`,"",s];this.ctx.fillStyle="rgba(15, 20, 30, 0.85)",this.ctx.fillRect(16,16,280,165),this.ctx.strokeStyle="rgba(100, 120, 140, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(16,16,280,165),this.ctx.font='14px Consolas, "Courier New", monospace';const c=t.verticalMode?[255,0,180]:[0,200,255];this.ctx.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`,this.ctx.beginPath(),this.ctx.arc(26,30,4,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`,this.ctx.fillText(`MODE: ${n}`,40,34),this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(O);let o=58;for(const H of d){if(H===""){o+=10;continue}this.ctx.fillText(H,26,o),o+=20}const r=T-280-16;this.ctx.fillStyle="rgba(15, 20, 30, 0.85)",this.ctx.fillRect(r,16,280,185),this.ctx.strokeStyle="rgba(100, 120, 140, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(r,16,280,185),this.ctx.font='14px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(M),this.ctx.fillText("FINANCIALS",r+10,34),this.ctx.font='15px Consolas, "Courier New", monospace';let a=58;this.ctx.fillStyle=x(y),this.ctx.fillText("Revenue:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(this.formatMoney(l.grossRevenue),r+270,a),this.ctx.textAlign="left",a+=20,this.ctx.fillStyle=x(S),this.ctx.fillText("Remediation:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(this.formatMoney(-l.remediationCosts),r+270,a),this.ctx.textAlign="left",a+=20,this.ctx.fillStyle=x(C),this.ctx.fillText("Sched Delay:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(`${l.scheduleVariance.toFixed(1)} sec`,r+270,a),this.ctx.textAlign="left",a+=20,this.ctx.fillStyle=x(C),this.ctx.fillText("Downstream:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(this.formatMoney(-l.downstreamPenalty),r+270,a),this.ctx.textAlign="left",a+=8,this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.moveTo(r+10,a),this.ctx.lineTo(r+270,a),this.ctx.stroke(),a+=20,this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=u>=0?x(y):x(S),this.ctx.fillText("NET PROFIT:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(this.formatMoney(u),r+270,a),this.ctx.textAlign="left",a+=25,this.ctx.fillStyle=x(O),this.ctx.font='14px Consolas, "Courier New", monospace',this.ctx.fillText("Accuracy:",r+10,a),this.ctx.textAlign="right",this.ctx.fillText(`${h.toFixed(0)}%`,r+270,a),this.ctx.textAlign="left",a+=10;const g=r+10,w=260,L=10,v=a;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(g,v,w,L);const $=h/100*w,X=h>=90?y:h>=75||h>=50?C:S;this.ctx.fillStyle=x(X),this.ctx.fillRect(g,v,$,L)}drawDrillWatermark(){this.ctx.save(),this.ctx.font='bold 180px Consolas, "Courier New", monospace',this.ctx.fillStyle="rgba(40, 50, 60, 0.15)",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("DRILL",T/2,P/2),this.ctx.restore()}drawBanner(t,e){const n=e<=D?y:e<=I?C:S;let i;t.failed?i="FAILED — too far off plan (press R)":t.finished?i="COMPLETE — nice drilling (press R)":i=e<=I?"ON TRACK":"OFF PLAN",this.ctx.font='bold 28px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(n),this.ctx.fillText(i,16,P-24)}drawEndReport(t){const e=t.economics,n=t.getNetProfit(),i=t.getAccuracyPercent();this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(0,0,T,P);const s=500,l=460,u=(T-s)/2,h=(P-l)/2;if(this.ctx.fillStyle="rgba(20, 24, 32, 0.98)",this.ctx.fillRect(u,h,s,l),this.ctx.strokeStyle=t.failed?x(S):x(y),this.ctx.lineWidth=3,this.ctx.strokeRect(u,h,s,l),this.ctx.font='bold 24px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(O),this.ctx.textAlign="center",this.ctx.fillText("DRILLING OPERATIONS REPORT",T/2,h+40),this.ctx.font='bold 20px Consolas, "Courier New", monospace',t.failed)this.ctx.fillStyle=x(S),this.ctx.fillText("⚠ HOLE ABANDONED - REDRILL REQUIRED ⚠",T/2,h+70);else{const v=n>1e4;this.ctx.fillStyle=x(y);const $=v?"✓ DRILLING COMPLETE - Nice Job":"✓ DRILLING COMPLETE";this.ctx.fillText($,T/2,h+70)}this.ctx.textAlign="left";const d=u+30,c=u+280;let o=h+110;this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(M),this.ctx.fillText("PERFORMANCE",d,o),o+=25,this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(O);const r=e.totalTime>0?(e.timeInTight/e.totalTime*100).toFixed(0):"0",a=e.totalTime>0?(e.timeInOK/e.totalTime*100).toFixed(0):"0",g=e.totalTime>0?(e.timeOutside/e.totalTime*100).toFixed(0):"0";this.ctx.fillStyle=x(y),this.ctx.fillText("Time in Tight:",d,o),this.ctx.fillText(`${e.timeInTight.toFixed(1)} sec (${r}%)`,c,o),o+=20,this.ctx.fillStyle=x(C),this.ctx.fillText("Time in OK:",d,o),this.ctx.fillText(`${e.timeInOK.toFixed(1)} sec (${a}%)`,c,o),o+=20,this.ctx.fillStyle=x(S),this.ctx.fillText("Time Outside:",d,o),this.ctx.fillText(`${e.timeOutside.toFixed(1)} sec (${g}%)`,c,o),o+=20,this.ctx.fillStyle=x(O),this.ctx.fillText("Total Time:",d,o),this.ctx.fillText(`${e.totalTime.toFixed(1)} sec`,c,o),o+=20,this.ctx.fillText("Accuracy:",d,o);const w=i>=90?y:i>=75||i>=50?C:S;if(this.ctx.fillStyle=x(w),this.ctx.fillText(`${i.toFixed(1)}%`,c,o),o+=35,this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(M),this.ctx.fillText("FINANCIALS",d,o),o+=25,this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(y),this.ctx.fillText("Gross Revenue:",d,o),this.ctx.fillText(this.formatMoney(e.grossRevenue),c,o),o+=20,this.ctx.fillStyle=x(S),this.ctx.fillText("Remediation Costs:",d,o),this.ctx.fillText(this.formatMoney(-e.remediationCosts),c,o),o+=20,this.ctx.fillStyle=x(C),this.ctx.fillText("Schedule Delay:",d,o),this.ctx.fillText(`${e.scheduleVariance.toFixed(1)} sec`,c,o),o+=20,this.ctx.fillStyle=x(S),this.ctx.fillText("Downstream Penalty:",d,o),this.ctx.fillText(this.formatMoney(-e.downstreamPenalty),c,o),o+=20,e.completionBonus!==0){this.ctx.fillStyle=e.completionBonus>0?x(y):x(S);const v=e.completionBonus>0?"Completion Bonus:":"Completion Penalty:";this.ctx.fillText(v,d,o),this.ctx.fillText(this.formatMoney(e.completionBonus),c,o),o+=20}o+=5,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(d,o),this.ctx.lineTo(u+s-30,o),this.ctx.stroke(),o+=20,this.ctx.font='bold 18px Consolas, "Courier New", monospace';let L;n>1e4?L=y:n>=0?L=C:L=S,this.ctx.fillStyle=x(L),this.ctx.fillText("NET PROFIT:",d,o),this.ctx.fillText(this.formatMoney(n),c,o),o+=35,this.ctx.font='16px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(O),this.ctx.textAlign="center",this.ctx.fillText("Press R to restart",T/2,o),this.ctx.textAlign="left"}drawVignette(t,e,n){const i=p(t.x,t.y,e,n,t.verticalMode),s=this.ctx.createRadialGradient(i[0],i[1],100,i[0],i[1],T*.7);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(.5,"rgba(0, 0, 0, 0.1)"),s.addColorStop(.8,"rgba(0, 0, 0, 0.5)"),s.addColorStop(1,"rgba(0, 0, 0, 0.75)"),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,T,P)}render(t,e=!1,n=""){this.clear(),this.drawGrid();let i,s,l,u,h,d;t.verticalMode?(s=t.y-40,i=0,h=Math.max(b,s-40),d=Math.min(A,s+U),l=R,u=E):(i=t.x-40,s=0,l=Math.max(R,i-40),u=Math.min(E,i+U),h=b,d=A);const{planLine:c}=this.drawCorridor(t,i,s,l,u,h,d);this.drawPlanLine(c),this.drawPlannedDrillholeLabels(t,i,s,h,d,l,u),this.drawActualPath(t,i,s,l,u,h,d),this.drawDrillRig(t,i,s),this.drawDrillHead(t,i,s),this.drawVignette(t,i,s);let o;if(t.verticalMode){const r=t.plan.x(t.y);o=Math.abs(t.x-r)}else{const r=t.plan.y(t.x);o=Math.abs(t.y-r)}this.drawHUD(t,o),this.drawBanner(t,o),e&&n?this.drawCountdown(n):(t.finished||t.failed)&&this.drawEndReport(t)}drawCountdown(t){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,T,P),this.ctx.font='bold 48px Consolas, "Courier New", monospace',this.ctx.fillStyle=x(M),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowBlur=20,this.ctx.shadowColor=x(M),this.ctx.fillText(t,T/2,P/2),this.ctx.shadowBlur=0,this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic"}}class ut{constructor(){f(this,"keysPressed",new Set);f(this,"keysJustPressed",new Set);window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){this.keysPressed.has(t.code)||this.keysJustPressed.add(t.code),this.keysPressed.add(t.code),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyT","KeyR","Escape"].includes(t.code)&&t.preventDefault()}handleKeyUp(t){this.keysPressed.delete(t.code)}isPressed(t){return this.keysPressed.has(t)}wasJustPressed(t){return this.keysJustPressed.has(t)}clearJustPressed(){this.keysJustPressed.clear()}getSteerInput(t){let e=0;return t?(this.isPressed("ArrowLeft")&&(e-=1),this.isPressed("ArrowRight")&&(e+=1)):(this.isPressed("ArrowUp")&&(e+=1),this.isPressed("ArrowDown")&&(e-=1)),e}destroy(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("keyup",this.handleKeyUp.bind(this))}}class gt{constructor(t){f(this,"state");f(this,"renderer");f(this,"input");f(this,"lastTime",0);f(this,"running",!1);f(this,"onModeChange");f(this,"countdownActive",!1);f(this,"countdownMessage","");this.renderer=new ft(t),this.input=new ut,this.state=N.new(!0)}start(){this.running=!0,this.lastTime=performance.now(),this.gameLoop()}stop(){this.running=!1}setModeChangeCallback(t){this.onModeChange=t}toggleMode(){var e;if(this.countdownActive)return;const t=!this.state.verticalMode;this.state=N.new(t),(e=this.onModeChange)==null||e.call(this,t)}restart(){this.startCountdown()}async startCountdown(){if(this.countdownActive)return;this.countdownActive=!0;const t=this.state.verticalMode;this.countdownMessage="Moving drill to position...",await this.wait(1e3),this.countdownMessage="Aligning the hole...",await this.wait(1e3),this.countdownMessage="Ready...",await this.wait(1e3),this.countdownMessage="Go!",await this.wait(1e3),this.state=N.new(t),this.countdownActive=!1,this.countdownMessage=""}wait(t){return new Promise(e=>setTimeout(e,t))}isCountdownActive(){return this.countdownActive}getCountdownMessage(){return this.countdownMessage}isVerticalMode(){return this.state.verticalMode}gameLoop(){if(!this.running)return;const t=performance.now(),e=(t-this.lastTime)/1e3;this.lastTime=t,this.handleInput(),this.update(e),this.renderer.render(this.state,this.countdownActive,this.countdownMessage),this.input.clearJustPressed(),requestAnimationFrame(()=>this.gameLoop())}handleInput(){this.input.wasJustPressed("KeyT")&&this.toggleMode(),this.input.wasJustPressed("KeyR")&&this.restart()}update(t){if(this.countdownActive||this.state.finished||this.state.failed)return;const e=this.input.getSteerInput(this.state.verticalMode);this.state.headingTarget+=e*Z*t,this.state.headingTarget=dt(this.state.headingTarget,-.55,.55);const n=1-Math.exp(-8*t);if(this.state.heading=(1-n)*this.state.heading+n*this.state.headingTarget,this.state.verticalMode){const l=K*t,u=Math.tan(this.state.heading)*l;this.state.x+=u,this.state.y+=l}else{const l=K*t,u=Math.tan(this.state.heading)*l;this.state.x+=l,this.state.y+=u}this.state.actualPoints.push([this.state.x,this.state.y]);let i;if(this.state.verticalMode){const l=this.state.plan.x(this.state.y);i=Math.abs(this.state.x-l)}else{const l=this.state.plan.y(this.state.x);i=Math.abs(this.state.y-l)}const s=this.state.economics;s.totalTime+=t,i<=D?(this.state.score+=Q*t,s.timeInTight+=t,s.grossRevenue+=tt*t,s.scheduleVariance=Math.max(0,s.scheduleVariance-ot*t)):i<=I?(this.state.score+=j*t,s.timeInOK+=t,s.grossRevenue+=et*t):(this.state.score+=z*t,s.timeOutside+=t,s.remediationCosts+=it*t,s.scheduleVariance+=st*t,this.state.outsideTime+=t),s.downstreamPenalty=s.scheduleVariance*nt,i<=I&&(this.state.outsideTime=Math.max(0,this.state.outsideTime-1.8*t)),this.state.outsideTime>=J&&(this.state.failed=!0,this.calculateCompletionBonus()),this.state.verticalMode?this.state.y>=A&&(this.state.finished=!0,this.calculateCompletionBonus()):this.state.x>=E&&(this.state.finished=!0,this.calculateCompletionBonus())}calculateCompletionBonus(){const t=this.state.getAccuracyPercent(),e=this.state.economics;this.state.failed?e.completionBonus=rt:t>=90?e.completionBonus=lt:t>=75?e.completionBonus=ct:t<50?e.completionBonus=ht:e.completionBonus=0}}function V(m){const t=document.getElementById("mode-text");t&&(t.textContent=m?"VERTICAL":"HORIZONTAL",t.classList.toggle("vertical",m))}function G(){const m=document.getElementById("game-canvas"),t=document.getElementById("mode-toggle"),e=document.getElementById("restart-btn");if(!m){console.error("Could not find game canvas element");return}const n=new gt(m);n.setModeChangeCallback(i=>{V(i)}),t==null||t.addEventListener("click",()=>{n.toggleMode()}),e==null||e.addEventListener("click",()=>{n.restart()}),V(n.isVerticalMode()),n.start(),document.addEventListener("visibilitychange",()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();
