var W=Object.defineProperty;var J=(a,t,e)=>t in a?W(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>J(a,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const w=1200,S=700,v=0,A=800,N=0,I=800,k=60,X=1.35,R=4,E=10,H=3.5,Y=25,q=10,Z=-30,Q=500,j=200,z=800,tt=2,et=.5,st=100,it=5e3,ot=2e3,nt=-1e4,lt=-25e3,_=160,O=1.2,B=10,ct=[16,18,24],ht=[40,44,58],b=[110,180,255],F=[255,180,110],p=[70,210,120],P=[220,200,80],y=[230,80,90],C=[230,235,245];function rt(a,t,e){return Math.max(t,Math.min(e,a))}function T(a,t,e,n,s){if(s){const o=Math.floor(w/2+a*(O*B/4)),l=Math.floor((t-n)*O+200);return[o,l]}else{const o=Math.floor((a-e)*O+200),l=Math.floor(S/2-t*(O*B/4));return[o,l]}}function c(a){return`rgb(${a[0]}, ${a[1]}, ${a[2]})`}function at(a,t){return`rgba(${a[0]}, ${a[1]}, ${a[2]}, ${t})`}class dt{constructor(t){r(this,"seed");this.seed=t}next(){let t=this.seed+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}uniform(t,e){return this.next()*(e-t)+t}randint(t,e){return Math.floor(this.next()*(e-t+1))+t}}class ${constructor(t){r(this,"seed");r(this,"a1");r(this,"a2");r(this,"w1");r(this,"w2");r(this,"phase1");r(this,"phase2");r(this,"slope");this.seed=t.seed,this.a1=t.a1,this.a2=t.a2,this.w1=t.w1,this.w2=t.w2,this.phase1=t.phase1,this.phase2=t.phase2,this.slope=t.slope}y(t){return this.slope*(t-v)/200+this.a1*Math.sin(this.w1*t+this.phase1)+this.a2*Math.sin(this.w2*t+this.phase2)}x(t){return this.slope*(t-N)/200+this.a1*Math.sin(this.w1*t+this.phase1)+this.a2*Math.sin(this.w2*t+this.phase2)}static random(){const t=Math.floor(Math.random()*1e6),e=new dt(t);return new $({seed:t,a1:e.uniform(8,18),a2:e.uniform(3,10),w1:e.uniform(.01,.018),w2:e.uniform(.02,.035),phase1:e.uniform(0,Math.PI*2),phase2:e.uniform(0,Math.PI*2),slope:e.uniform(-8,8)})}}class L{constructor(t){r(this,"plan");r(this,"x");r(this,"y");r(this,"heading");r(this,"headingTarget");r(this,"score");r(this,"outsideTime");r(this,"finished");r(this,"failed");r(this,"verticalMode");r(this,"actualPoints");r(this,"economics");this.plan=t.plan,this.x=t.x,this.y=t.y,this.heading=t.heading,this.headingTarget=t.headingTarget,this.score=t.score,this.outsideTime=t.outsideTime,this.finished=t.finished,this.failed=t.failed,this.verticalMode=t.verticalMode,this.actualPoints=t.actualPoints,this.economics=t.economics}static createEmptyEconomics(){return{grossRevenue:0,remediationCosts:0,scheduleVariance:0,downstreamPenalty:0,timeInTight:0,timeInOK:0,timeOutside:0,totalTime:0,completionBonus:0}}getAccuracyPercent(){return this.economics.totalTime===0?100:(this.economics.timeInTight+this.economics.timeInOK)/this.economics.totalTime*100}getNetProfit(){return this.economics.grossRevenue-this.economics.remediationCosts-this.economics.downstreamPenalty+this.economics.completionBonus}static new(t=!1){const e=$.random();let n,s,o;return t?(s=N,n=e.x(s),o=0):(n=v,s=e.y(n),o=0),new L({plan:e,x:n,y:s,heading:o,headingTarget:o,score:0,outsideTime:0,finished:!1,failed:!1,verticalMode:t,actualPoints:[[n,s]],economics:L.createEmptyEconomics()})}}class xt{constructor(t){r(this,"canvas");r(this,"ctx");this.canvas=t,this.canvas.width=w,this.canvas.height=S;const e=t.getContext("2d");if(!e)throw new Error("Could not get 2D context");this.ctx=e}clear(){this.ctx.fillStyle=c(ct),this.ctx.fillRect(0,0,w,S)}drawGrid(){this.ctx.strokeStyle=c(ht),this.ctx.lineWidth=1;for(let t=0;t<w;t+=80)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,S),this.ctx.stroke();for(let t=0;t<S;t+=80)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(w,t),this.ctx.stroke()}drawCorridor(t,e,n,s,o,l,u){const d=[];if(t.verticalMode){const h=[],i=[],g=[],M=[];for(let f=l;f<=u;f+=4){const m=t.plan.x(f);d.push(T(m,f,e,n,!0)),h.push(T(m-E,f,e,n,!0)),i.push(T(m+E,f,e,n,!0)),g.push(T(m-R,f,e,n,!0)),M.push(T(m+R,f,e,n,!0))}h.length>=2&&this.drawPolygon([...h,...i.reverse()],P,.14),g.length>=2&&this.drawPolygon([...g,...M.reverse()],p,.22)}else{const h=[],i=[],g=[],M=[];for(let f=s;f<=o;f+=4){const m=t.plan.y(f);d.push(T(f,m,e,n,!1)),h.push(T(f,m+E,e,n,!1)),i.push(T(f,m-E,e,n,!1)),g.push(T(f,m+R,e,n,!1)),M.push(T(f,m-R,e,n,!1))}h.length>=2&&this.drawPolygon([...h,...i.reverse()],P,.14),g.length>=2&&this.drawPolygon([...g,...M.reverse()],p,.22)}return{planLine:d}}drawPolygon(t,e,n){if(!(t.length<3)){this.ctx.fillStyle=at(e,n),this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(let s=1;s<t.length;s++)this.ctx.lineTo(t[s][0],t[s][1]);this.ctx.closePath(),this.ctx.fill()}}drawPlanLine(t){if(!(t.length<2)){this.ctx.strokeStyle=c(b),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1]);this.ctx.stroke()}}drawActualPath(t,e,n,s,o,l,u){const x=[],d=t.actualPoints.slice(-4e3);for(const[h,i]of d)t.verticalMode?i>=l-20&&i<=u+20&&x.push(T(h,i,e,n,!0)):h>=s-20&&h<=o+20&&x.push(T(h,i,e,n,!1));if(x.length>=2){this.ctx.strokeStyle=c(F),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(x[0][0],x[0][1]);for(let h=1;h<x.length;h++)this.ctx.lineTo(x[h][0],x[h][1]);this.ctx.stroke()}}drawDrillHead(t,e,n){const s=T(t.x,t.y,e,n,t.verticalMode);this.ctx.fillStyle=c(F),this.ctx.beginPath(),this.ctx.arc(s[0],s[1],7,0,Math.PI*2),this.ctx.fill();let o,l;t.verticalMode?(o=s[0]+Math.floor(24*Math.sin(t.heading)),l=s[1]+Math.floor(24*Math.cos(t.heading))):(o=s[0]+Math.floor(24*Math.cos(t.heading)),l=s[1]-Math.floor(24*Math.sin(t.heading))),this.ctx.strokeStyle=c(F),this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(o,l),this.ctx.stroke()}formatMoney(t){return(t>=0?"$":"-$")+Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}drawHUD(t,e){let n,s,o;t.verticalMode?(n="VERTICAL",s=`Depth Y: ${t.y.toFixed(1).padStart(7)} m / ${I.toFixed(0)} m`,o="← → steer | T toggle | R restart"):(n="HORIZONTAL",s=`Depth X: ${t.x.toFixed(1).padStart(7)} m / ${A.toFixed(0)} m`,o="↑ ↓ steer | T toggle | R restart");const l=t.economics,u=t.getNetProfit(),x=t.getAccuracyPercent(),d=[`Mode: ${n}`,s,`Deviation: ${e.toFixed(2).padStart(6)} m`,`Heading: ${(t.heading*180/Math.PI).toFixed(1).padStart(6)}°`,`Outside: ${t.outsideTime.toFixed(1)} / ${H.toFixed(1)} s`,o];this.ctx.fillStyle="rgba(0, 0, 0, 0.55)",this.ctx.fillRect(16,16,320,145),this.ctx.font='16px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(C);let h=34;for(const G of d)this.ctx.fillText(G,26,h),h+=20;const i=w-300-16;this.ctx.fillStyle="rgba(0, 0, 0, 0.55)",this.ctx.fillRect(i,16,300,165),this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(b),this.ctx.fillText("FINANCIALS",i+10,34),this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(p),this.ctx.fillText(`Revenue:      ${this.formatMoney(l.grossRevenue).padStart(10)}`,i+10,56),this.ctx.fillStyle=c(y),this.ctx.fillText(`Remediation: ${this.formatMoney(-l.remediationCosts).padStart(10)}`,i+10,76),this.ctx.fillStyle=c(P),this.ctx.fillText(`Sched Delay: ${l.scheduleVariance.toFixed(1).padStart(7)} sec`,i+10,96),this.ctx.fillText(`Downstream:  ${this.formatMoney(-l.downstreamPenalty).padStart(10)}`,i+10,116),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.moveTo(i+10,126),this.ctx.lineTo(i+290,126),this.ctx.stroke(),this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=u>=0?c(p):c(y),this.ctx.fillText(`NET PROFIT:  ${this.formatMoney(u).padStart(10)}`,i+10,146),this.ctx.fillStyle=c(C),this.ctx.font='14px Consolas, "Courier New", monospace',this.ctx.fillText(`Accuracy: ${x.toFixed(0)}%`,i+10,168);const g=i+120,M=160,f=10,m=160;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(g,m,M,f);const D=x/100*M,V=x>=90?p:x>=75||x>=50?P:y;this.ctx.fillStyle=c(V),this.ctx.fillRect(g,m,D,f)}drawBanner(t,e){const n=e<=R?p:e<=E?P:y;let s;t.failed?s="FAILED — too far off plan (press R)":t.finished?s="COMPLETE — nice drilling (press R)":s=e<=E?"ON TRACK":"OFF PLAN",this.ctx.font='bold 28px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(n),this.ctx.fillText(s,16,S-24)}drawEndReport(t){const e=t.economics,n=t.getNetProfit(),s=t.getAccuracyPercent();this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(0,0,w,S);const o=500,l=460,u=(w-o)/2,x=(S-l)/2;this.ctx.fillStyle="rgba(20, 24, 32, 0.98)",this.ctx.fillRect(u,x,o,l),this.ctx.strokeStyle=t.failed?c(y):c(p),this.ctx.lineWidth=3,this.ctx.strokeRect(u,x,o,l),this.ctx.font='bold 24px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(C),this.ctx.textAlign="center",this.ctx.fillText("DRILLING OPERATIONS REPORT",w/2,x+40),this.ctx.font='bold 20px Consolas, "Courier New", monospace',t.failed?(this.ctx.fillStyle=c(y),this.ctx.fillText("⚠ HOLE ABANDONED - REDRILL REQUIRED ⚠",w/2,x+70)):(this.ctx.fillStyle=c(p),this.ctx.fillText("✓ DRILLING COMPLETE",w/2,x+70)),this.ctx.textAlign="left";const d=u+30,h=u+280;let i=x+110;this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(b),this.ctx.fillText("PERFORMANCE",d,i),i+=25,this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(C);const g=e.totalTime>0?(e.timeInTight/e.totalTime*100).toFixed(0):"0",M=e.totalTime>0?(e.timeInOK/e.totalTime*100).toFixed(0):"0",f=e.totalTime>0?(e.timeOutside/e.totalTime*100).toFixed(0):"0";this.ctx.fillStyle=c(p),this.ctx.fillText("Time in Tight:",d,i),this.ctx.fillText(`${e.timeInTight.toFixed(1)} sec (${g}%)`,h,i),i+=20,this.ctx.fillStyle=c(P),this.ctx.fillText("Time in OK:",d,i),this.ctx.fillText(`${e.timeInOK.toFixed(1)} sec (${M}%)`,h,i),i+=20,this.ctx.fillStyle=c(y),this.ctx.fillText("Time Outside:",d,i),this.ctx.fillText(`${e.timeOutside.toFixed(1)} sec (${f}%)`,h,i),i+=20,this.ctx.fillStyle=c(C),this.ctx.fillText("Total Time:",d,i),this.ctx.fillText(`${e.totalTime.toFixed(1)} sec`,h,i),i+=20,this.ctx.fillText("Accuracy:",d,i);const m=s>=90?p:s>=75||s>=50?P:y;if(this.ctx.fillStyle=c(m),this.ctx.fillText(`${s.toFixed(1)}%`,h,i),i+=35,this.ctx.font='bold 16px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(b),this.ctx.fillText("FINANCIALS",d,i),i+=25,this.ctx.font='15px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(p),this.ctx.fillText("Gross Revenue:",d,i),this.ctx.fillText(this.formatMoney(e.grossRevenue),h,i),i+=20,this.ctx.fillStyle=c(y),this.ctx.fillText("Remediation Costs:",d,i),this.ctx.fillText(this.formatMoney(-e.remediationCosts),h,i),i+=20,this.ctx.fillStyle=c(P),this.ctx.fillText("Schedule Delay:",d,i),this.ctx.fillText(`${e.scheduleVariance.toFixed(1)} sec`,h,i),i+=20,this.ctx.fillStyle=c(y),this.ctx.fillText("Downstream Penalty:",d,i),this.ctx.fillText(this.formatMoney(-e.downstreamPenalty),h,i),i+=20,e.completionBonus!==0){this.ctx.fillStyle=e.completionBonus>0?c(p):c(y);const D=e.completionBonus>0?"Completion Bonus:":"Completion Penalty:";this.ctx.fillText(D,d,i),this.ctx.fillText(this.formatMoney(e.completionBonus),h,i),i+=20}i+=5,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(d,i),this.ctx.lineTo(u+o-30,i),this.ctx.stroke(),i+=20,this.ctx.font='bold 18px Consolas, "Courier New", monospace',this.ctx.fillStyle=n>=0?c(p):c(y),this.ctx.fillText("NET PROFIT:",d,i),this.ctx.fillText(this.formatMoney(n),h,i),i+=35,this.ctx.font='16px Consolas, "Courier New", monospace',this.ctx.fillStyle=c(C),this.ctx.textAlign="center",this.ctx.fillText("Press R to restart",w/2,i),this.ctx.textAlign="left"}render(t){this.clear(),this.drawGrid();let e,n,s,o,l,u;t.verticalMode?(n=t.y-40,e=0,l=Math.max(N,n-40),u=Math.min(I,n+_),s=v,o=A):(e=t.x-40,n=0,s=Math.max(v,e-40),o=Math.min(A,e+_),l=N,u=I);const{planLine:x}=this.drawCorridor(t,e,n,s,o,l,u);this.drawPlanLine(x),this.drawActualPath(t,e,n,s,o,l,u),this.drawDrillHead(t,e,n);let d;if(t.verticalMode){const h=t.plan.x(t.y);d=Math.abs(t.x-h)}else{const h=t.plan.y(t.x);d=Math.abs(t.y-h)}this.drawHUD(t,d),this.drawBanner(t,d),(t.finished||t.failed)&&this.drawEndReport(t)}}class ft{constructor(){r(this,"keysPressed",new Set);r(this,"keysJustPressed",new Set);window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){this.keysPressed.has(t.code)||this.keysJustPressed.add(t.code),this.keysPressed.add(t.code),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyT","KeyR","Escape"].includes(t.code)&&t.preventDefault()}handleKeyUp(t){this.keysPressed.delete(t.code)}isPressed(t){return this.keysPressed.has(t)}wasJustPressed(t){return this.keysJustPressed.has(t)}clearJustPressed(){this.keysJustPressed.clear()}getSteerInput(t){let e=0;return t?(this.isPressed("ArrowLeft")&&(e-=1),this.isPressed("ArrowRight")&&(e+=1)):(this.isPressed("ArrowUp")&&(e+=1),this.isPressed("ArrowDown")&&(e-=1)),e}destroy(){window.removeEventListener("keydown",this.handleKeyDown.bind(this)),window.removeEventListener("keyup",this.handleKeyUp.bind(this))}}class ut{constructor(t){r(this,"state");r(this,"renderer");r(this,"input");r(this,"lastTime",0);r(this,"running",!1);r(this,"onModeChange");this.renderer=new xt(t),this.input=new ft,this.state=L.new(!1)}start(){this.running=!0,this.lastTime=performance.now(),this.gameLoop()}stop(){this.running=!1}setModeChangeCallback(t){this.onModeChange=t}toggleMode(){var e;const t=!this.state.verticalMode;this.state=L.new(t),(e=this.onModeChange)==null||e.call(this,t)}restart(){this.state=L.new(this.state.verticalMode)}isVerticalMode(){return this.state.verticalMode}gameLoop(){if(!this.running)return;const t=performance.now(),e=(t-this.lastTime)/1e3;this.lastTime=t,this.handleInput(),this.update(e),this.renderer.render(this.state),this.input.clearJustPressed(),requestAnimationFrame(()=>this.gameLoop())}handleInput(){this.input.wasJustPressed("KeyT")&&this.toggleMode(),this.input.wasJustPressed("KeyR")&&this.restart()}update(t){if(this.state.finished||this.state.failed)return;const e=this.input.getSteerInput(this.state.verticalMode);this.state.headingTarget+=e*X*t,this.state.headingTarget=rt(this.state.headingTarget,-.55,.55);const n=1-Math.exp(-8*t);if(this.state.heading=(1-n)*this.state.heading+n*this.state.headingTarget,this.state.verticalMode){const l=k*t,u=Math.tan(this.state.heading)*l;this.state.x+=u,this.state.y+=l}else{const l=k*t,u=Math.tan(this.state.heading)*l;this.state.x+=l,this.state.y+=u}this.state.actualPoints.push([this.state.x,this.state.y]);let s;if(this.state.verticalMode){const l=this.state.plan.x(this.state.y);s=Math.abs(this.state.x-l)}else{const l=this.state.plan.y(this.state.x);s=Math.abs(this.state.y-l)}const o=this.state.economics;o.totalTime+=t,s<=R?(this.state.score+=Y*t,o.timeInTight+=t,o.grossRevenue+=Q*t,o.scheduleVariance=Math.max(0,o.scheduleVariance-et*t)):s<=E?(this.state.score+=q*t,o.timeInOK+=t,o.grossRevenue+=j*t):(this.state.score+=Z*t,o.timeOutside+=t,o.remediationCosts+=z*t,o.scheduleVariance+=tt*t,this.state.outsideTime+=t),o.downstreamPenalty=o.scheduleVariance*st,s<=E&&(this.state.outsideTime=Math.max(0,this.state.outsideTime-1.8*t)),this.state.outsideTime>=H&&(this.state.failed=!0,this.calculateCompletionBonus()),this.state.verticalMode?this.state.y>=I&&(this.state.finished=!0,this.calculateCompletionBonus()):this.state.x>=A&&(this.state.finished=!0,this.calculateCompletionBonus())}calculateCompletionBonus(){const t=this.state.getAccuracyPercent(),e=this.state.economics;this.state.failed?e.completionBonus=lt:t>=90?e.completionBonus=it:t>=75?e.completionBonus=ot:t<50?e.completionBonus=nt:e.completionBonus=0}}function K(a){const t=document.getElementById("mode-text");t&&(t.textContent=a?"VERTICAL":"HORIZONTAL",t.classList.toggle("vertical",a))}function U(){const a=document.getElementById("game-canvas"),t=document.getElementById("mode-toggle"),e=document.getElementById("restart-btn");if(!a){console.error("Could not find game canvas element");return}const n=new ut(a);n.setModeChangeCallback(s=>{K(s)}),t==null||t.addEventListener("click",()=>{n.toggleMode()}),e==null||e.addEventListener("click",()=>{n.restart()}),K(n.isVerticalMode()),n.start(),document.addEventListener("visibilitychange",()=>{})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",U):U();
